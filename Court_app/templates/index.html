<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Court Data Fetcher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container { max-width: 800px; margin-top: 50px; }
        .card { margin-bottom: 20px; }
        .result-section { display: none; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Court Data Fetcher</h1>
        
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5>Search Case Details</h5>
            </div>
            <div class="card-body">
                <form id="searchForm">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Court Type</label>
                            <select class="form-select" name="court_type" required>
                                <option value="district_court">District Court</option>
                                <option value="high_court">High Court</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Case Type</label>
                            <input type="text" class="form-control" name="case_type" placeholder="e.g., CR, CV, FA" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Case Number</label>
                            <input type="text" class="form-control" name="case_number" placeholder="Case number" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Year</label>
                            <input type="number" class="form-control" name="year" placeholder="2023" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Search Case</button>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header bg-success text-white">
                <h5>Check Case in Cause List</h5>
            </div>
            <div class="card-body">
                <form id="checkCauseListForm">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Court Type</label>
                            <select class="form-select" name="court_type" required>
                                <option value="district_court">District Court</option>
                                <option value="high_court">High Court</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Case Number</label>
                            <input type="text" class="form-control" name="case_number" placeholder="Case number to check" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Date (optional)</label>
                            <input type="date" class="form-control" name="date">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success me-2">Check Case</button>
                    <button type="button" class="btn btn-info" onclick="downloadCauseList()">Download Cause List PDF</button>
                </form>
            </div>
        </div>

        <div id="resultSection" class="result-section card">
            <div class="card-header bg-info text-white">
                <h5>Results</h5>
            </div>
            <div class="card-body">
                <div id="resultContent"></div>
            </div>
        </div>

        <div id="errorAlert" class="alert alert-danger result-section" style="display: none;">
            <strong>Error:</strong> <span id="errorMessage"></span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            searchCase();
        });

        document.getElementById('checkCauseListForm').addEventListener('submit', function(e) {
            e.preventDefault();
            checkCaseInCauseList();
        });

        function searchCase() {
            const formData = new FormData(document.getElementById('searchForm'));
            
            fetch('/search_case', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showError(data.error);
                } else {
                    showResult(`
                        <h6>Case Details:</h6>
                        <p><strong>Parties:</strong> ${data.parties || 'N/A'}</p>
                        <p><strong>Filing Date:</strong> ${data.filing_date || 'N/A'}</p>
                        <p><strong>Next Hearing Date:</strong> ${data.next_hearing_date || 'N/A'}</p>
                        <p><strong>Case Status:</strong> ${data.case_status || 'N/A'}</p>
                        ${data.judgment_url ? `<a href="${data.judgment_url}" class="btn btn-primary mt-2">Download Judgment</a>` : ''}
                    `);
                }
            })
            .catch(error => showError('Network error: ' + error.message));
        }

        function checkCaseInCauseList() {
            const formData = new FormData(document.getElementById('checkCauseListForm'));
            
            fetch('/check_case_in_cause_list', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showError(data.error);
                } else {
                    const status = data.found ? '✅ FOUND' : '❌ NOT FOUND';
                    showResult(`
                        <h6>Case Check Result:</h6>
                        <p><strong>Status:</strong> ${status}</p>
                        <p><strong>Case Number:</strong> ${data.case_number}</p>
                        <p><strong>Court:</strong> ${data.court}</p>
                        <p><strong>Date Checked:</strong> ${data.date}</p>
                    `);
                }
            })
            .catch(error => showError('Network error: ' + error.message));
        }

        function downloadCauseList() {
            const formData = new FormData(document.getElementById('checkCauseListForm'));
            
            fetch('/download_cause_list', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    return response.blob().then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'cause_list.pdf';
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                    });
                } else {
                    return response.json().then(data => {
                        showError(data.error || 'Failed to download cause list');
                    });
                }
            })
            .catch(error => showError('Network error: ' + error.message));
        }

        function showResult(content) {
            document.getElementById('errorAlert').style.display = 'none';
            document.getElementById('resultContent').innerHTML = content;
            document.getElementById('resultSection').style.display = 'block';
        }

        function showError(message) {
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorAlert').style.display = 'block';
        }
    </script>
</body>
</html>